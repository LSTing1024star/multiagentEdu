# multiagentEdu 教育智能助手使用文档

## 项目概述
multiagentEdu 是一个基于多智能体系统的教育辅助工具，旨在通过学业评估、个性化学习规划、交互式问题引导和智能冲突协调，为学生提供定制化的学习支持。系统整合了数据库管理、LLM（大语言模型）交互和多智能体协作技术，适用于数学、语文、英语等多学科的学习辅助场景。


## 环境准备
### 依赖要求
- Python 3.8+
- 相关依赖库（建议通过 `requirements.txt` 安装，具体依赖根据代码中引入的库确定，如 `fastapi`、`pandas` 等）
- 数据集：需准备 Assistment2009 数据集（`skill_builder_data.csv`），默认路径为 `/home/lst/data/assistment2009/`，可自定义路径（暂时）


## 快速启动
### 1. 启动 API 服务
通过以下命令启动后端 API 服务，提供学习规划等核心功能的接口调用：
```bash
python main.py
```

### 2. 运行实验数据分析
如需分析评估准确性和规划效果，执行：
```bash
python main.py --analyze
```
> 注意：确保 `main.py` 中数据分析函数（`analyze_assessment_accuracy`、`analyze_plan_effectiveness`）的文件路径指向实际数据文件，默认读取项目根目录下 `data` 文件夹中的 CSV 文件。


## 核心功能模块说明

### 1. 交互式终端功能（`src/main.py`）
终端交互是系统的主要入口，支持通过菜单选择功能，包含以下模块：

#### 1.1 学业评估（功能编号 1）
- **功能**：分析学生的薄弱知识点、综合能力等级和诊断结论。
- **使用步骤**：
  1. 输入学生 ID（如 `S92523`）
  2. 输入科目（支持 `math`/语文/英语）
  3. 系统自动生成评估结果，包括：
     - 薄弱知识点列表
     - 综合能力等级（1-5 分）
     - 针对性诊断结论

#### 1.2 学习规划（功能编号 2）
- **功能**：根据学生当前水平和长期目标，生成个性化学习计划。
- **使用步骤**：
  1. 输入学生 ID、科目和长期目标（如“期末数学提分 20 分”）
  2. 可选输入执行反馈（未完成任务 ID、完成率、备注）
  3. 系统输出：
     - 长期目标拆解
     - 周任务安排（前 3 周详情）
     - 推荐学习资源（前 5 项）

#### 1.3 问题引导（功能编号 3）
- **功能**：通过交互式追问和场景化引导，帮助学生理解并解决具体问题。
- **使用步骤**：
  1. 输入学生 ID、科目和具体问题（如“为什么函数 f(x)=x²-4x+3 在 x>2 时单调递增？”）
  2. 第一轮：系统生成 3 个场景化追问（聚焦知识缺口、方法误解、场景应用）
  3. 可选输入追问答案，系统进入第二轮：
     - 场景化引导步骤
     - 推荐匹配的学习资源（视频优先）
     - 迁移化提示（同类场景解题方法）

#### 1.4 智能协调（功能编号 4）
- **功能**：检测学习计划与学生实际水平的冲突，并优化方案。
- **使用步骤**：
  1. 输入学生 ID、科目和长期目标
  2. 可选输入执行反馈（任务 ID、完成率）
  3. 系统输出：
     - 冲突检测结果（类型和详情）
     - 冲突处理记录
     - 优化后的学习计划


### 2. API 接口（`utils/api.py`）
系统提供 RESTful API 接口，支持外部系统调用核心功能。

#### 接口：获取个性化学习规划
- **URL**：`/api/v1/planning`
- **方法**：`POST`
- **请求体（PlanningRequest）**：
  ```json
  {
    "student_id": "S92523",
    "subject": "math",
    "long_term_goal": "期末数学提分20分",
    "execution_feedback": {
      "task_id": "T001",
      "completion_rate": 70,
      "feedback_note": "函数部分掌握不牢固"
    }
  }
  ```
- **响应体（PlanningResponse）**：
  ```json
  {
    "student_id": "S92523",
    "personalized_plan": {
      "long_term_goal": "期末数学提分20分",
      "weekly_tasks": [...]
    },
    "conflict_resolution_log": ["冲突类型：目标-能力不匹配，详情：当前能力无法满足目标进度"],
    "recommended_resources": [...]
  }
  ```
- **说明**：接口内部通过规划智能体生成初始计划，评估智能体提供学生水平数据，协调智能体检测并解决冲突，最终返回优化后的计划和资源推荐。


### 3. 数据处理（`functions/dataprocessor.py`）
负责 Assistment2009 数据集的加载、预处理和数据提取，支持以下功能：

- **数据集加载**：读取 `skill_builder_data.csv` 并验证完整性
- **预处理**：提取核心字段（`user_id`、`skill_name`、`problem_id` 等），计算错误率和难度等级
- **学生数据构建**：生成学生画像（含答题历史、薄弱知识点等）
- **资源数据构建**：整理学习资源（含知识点、难度、错误率等）
- **知识图谱构建**：按分类组织知识点（如数学中的“二次函数”“导数应用”等）

#### 测试方法
运行数据处理测试函数，验证核心功能：
```python
from functions.dataprocessor import test_real_assistment_data_processor
test_real_assistment_data_processor()
```
测试将输出预处理后的数据示例、学生信息、资源详情和知识图谱分类。


### 4. 智能体模块（`agents/`）
系统包含多个智能体，分工协作完成教育辅助任务：

| 智能体类名               | 功能说明                                                                 | 核心方法                          |
|--------------------------|--------------------------------------------------------------------------|-----------------------------------|
| `AcademicAssessmentAgent` | 评估学生学业水平，生成薄弱点和能力等级                                   | `run(student_id, subject)`        |
| `AcademicPlanningAgent`  | 根据评估结果和长期目标，生成/优化学习计划                                | `run(student_id, subject, goal)`  |
| `AcademicGuidanceAgent`  | 交互式引导学生解决问题，提供场景化拆解和资源推荐                          | `run(student_id, subject, question)` |
| `CoordinatorAgent`       | 检测学习计划与学生水平的冲突（如目标过高），并优化计划                    | `detect_conflict()`, `resolve_conflict()` |
| `DatabaseManagerAgent`   | 管理数据集，提供学生数据、资源数据查询接口                               | 内部方法（如 `get_student_data()`） |


### 5. 工具函数（`utils/utils.py`）
提供结果格式化功能，根据不同智能体的输出类型，生成易读的文本：
- 协调智能体结果：展示学生ID、科目、冲突数量、评估摘要等
- 问题引导智能体结果：展示追问问题、场景化引导步骤、推荐资源
- 规划智能体结果：展示长期目标、周任务安排
- 评估智能体结果：展示薄弱知识点、能力等级、诊断结论


## 示例场景

以下是 multiagentEdu 各核心功能的具体使用场景，结合真实学习场景展示功能流程和效果：


### 1. 学业评估功能场景  
**操作步骤**：  
1. 终端选择“1. 学业评估”，输入学生ID `S92523`，科目 `math`。  
2. 系统调用 `AcademicAssessmentAgent`，通过 `DatabaseManagerAgent` 读取S92523的答题历史（来自 `skill_builder_data.csv`），分析其在“二次函数”“一元二次方程”等知识点的错误率。  
3. 结合 LLM 对错误模式的解读，生成评估结果。  

**系统输出**：  
```  
📊 学业评估结果：
薄弱知识点：函数单调性概念理解, 导数与函数关系的综合应用, 几何证明的逻辑推理
综合能力等级：2/5
诊断结论：学生运算基础扎实但函数概念理解薄弱，存在严重的学习拖延问题，综合应用能力有待提升
```  


## 2. 学习规划功能场景
**操作步骤**：  
1. 终端选择“2. 学习规划”，输入学生ID `S92523`，科目 `math`，长期目标“期末数学失分率不多于10%”。  
2. 选择“有执行反馈”，输入未完成任务ID `T012`，完成率60%，备注“几何题目总是没有图形思维”。  
3. 系统通过 `AcademicPlanningAgent` 先调用评估结果，再结合反馈生成计划。  

**系统输出**：  
```  
👉 功能编号：2
🎒 学生ID：S92523
📚 科目（如math/语文/英语）：math
🎯 长期目标（如：期末数学提分20分）：期末数学失分率不多于10%
是否有执行反馈？(y/n)：y
📝 未完成任务ID：T012
📊 任务完成率（%）：60
💡 反馈备注：几何题目总是没有图形思维

⏳ 正在生成学习规划...

===== 个性化学习规划 =====
📅 个性化学习规划：
长期目标：期末数学失分率不多于10%
周任务安排：
- 第1周：
  ✅ 学习函数单调性概念理解基础知识点（资源ID：default_r1）（时长：3h）
- 第2周：
  ✅ 学习函数单调性概念理解基础知识点（资源ID：default_r1）（时长：3h）
- 第3周：
  ✅ 学习函数单调性概念理解进阶知识点（资源ID：default_r2）（时长：4h）  
```  


## 3. 问题引导功能场景：初中生函数单调性解题指导  
**操作步骤**：  
1. 终端选择“3. 问题引导”，输入学生ID `S92523`，科目 `math`，问题描述“为什么2=3”。  
2. 第一轮：选择“未回答追问”，系统生成场景化追问。  
3. 小刚回答追问后（如“生活中气温上升可以类比？卡在导数符号判断”），进入第二轮引导。  

**系统输出**：  
```  
❓ 问题引导结果（第一轮）  
📝 场景化引导：
1. Step1：将问题转化为日常学习场景场景理解（比如：为什么2=3）
2. Step2：从场景中提取核心数学关系（如变量/规律/约束条件）
3. Step3：回归知识点基础知识点的解题方法
4. Step4：验证场景结论与数学结论的一致性 

（第二轮，基于学生回答）  
🎒 学生ID：S92523
📚 科目（如math/语文/英语）：math
❓ 你的问题（如：为什么函数f(x)=x²在x>0时递增？）：为什么2=3
是否已回答追问？(y/n)：y
💡 请输入你的回答（输入q结束）：
⏳ 正在生成引导方案...
===== 问题引导结果 =====
❓ 交互式追问：
📝 场景化引导：
1. Step1：将问题转化为日常学习场景场景理解（比如：为什么2=3）
2. Step2：从场景中提取核心数学关系（如变量/规律/约束条件）
3. Step3：回归知识点基础知识点的解题方法
4. Step4：验证场景结论与数学结论的一致性
```  


## 4. 智能协调功能场景：计划进度滞后与资源难度冲突优化  
**操作步骤**：  
1. 终端选择“4. 智能协调”，输入学生ID `S92523`，科目 `math`，长期目标“中考数学部分正确率≥97%”。  
2. 选择“有执行反馈”，输入任务ID `T045`，完成率40%。  
3. 系统通过 `CoordinatorAgent` 检测冲突：进度滞后（需补2小时任务量）+ 资源难度与能力不匹配（小丽能力等级3，资源难度5）。  

**系统输出**：  
```  
🔧 智能协调结果  
有点问题，还没正确实现
```  


以上场景覆盖了各功能的核心流程，展示了系统如何结合学生数据、交互反馈和智能体协作，提供个性化教育支持。


## 注意事项
1. 数据集路径：若自定义数据集路径，需在初始化 `AgentsManager` 时传入，如 `AgentsManager(data_path="/custom/path/skill_builder_data.csv")`
2. 科目支持：当前仅支持 `math`/语文/英语，其他科目需扩展代码中的验证逻辑
3. LLM 配置：默认使用 `llama3-edu` 模型，可在 `LLMClient` 初始化时修改模型类型和名称
4. 错误处理：功能执行失败时，终端会显示错误信息，可根据提示检查输入参数或数据路径


通过以上功能，multiagentEdu 可实现对学生学习过程的全流程辅助，从评估诊断到计划执行，再到问题解决，提供个性化、场景化的教育支持。